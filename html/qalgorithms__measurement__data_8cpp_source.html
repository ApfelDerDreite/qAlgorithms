<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QAlgorithms: src/qalgorithms_measurement_data.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">QAlgorithms
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">qalgorithms_measurement_data.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="qalgorithms__measurement__data_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">// qalgorithm_measurement_data.cpp</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span> </div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">// internal</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="preprocessor">#include &quot;<a class="code" href="qalgorithms__measurement__data_8h.html">../include/qalgorithms_measurement_data.h</a>&quot;</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span> </div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceq.html">q</a> {</div>
<div class="foldopen" id="foldopen00007" data-start="{" data-end="}">
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno"><a class="line" href="classq_1_1_measurement_data.html#ae3dfbca5264b979f312f581491addf63">    7</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classq_1_1_measurement_data.html#ae3dfbca5264b979f312f581491addf63">MeasurementData::zeroFilling</a>(</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span>    std::vector&lt;double&gt;&amp; xData, </div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span>    std::vector&lt;double&gt;&amp; yData, </div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span>    <span class="keywordtype">int</span> k) {</div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span>    <span class="comment">// calculate the differences</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span>    <span class="keywordtype">double</span> expectedDifference = 0.0;</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span>    std::vector&lt;double&gt; differences;</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; xData.size(); i++) {</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span>        differences.push_back(xData[i] - xData[i-1]);</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span>    }</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span>    <span class="comment">// median of differences</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span>    std::sort(differences.begin(), differences.end());</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span>    <span class="keywordflow">if</span> (differences.size() % 2 == 0) {</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span>        expectedDifference = (differences[differences.size()/2 - 1] + differences[differences.size()/2]) / 2;</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>        expectedDifference = differences[differences.size()/2];</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>    }</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span> </div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>    <span class="comment">// fill the gaps</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; xData.size(); i++) {</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>      <span class="keywordtype">double</span> difference = xData[i] - xData[i-1];</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>      <span class="comment">/* We will always add new data points in the beginning of the data set. */</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>      <span class="keywordflow">if</span> (i == 1) {</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>        <span class="keywordtype">int</span> gapSize = (int) k/2;</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = gapSize; j &gt;= 1; j--) { <span class="comment">// fill the gap backwards</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>          xData.insert(xData.begin(), xData[0] - expectedDifference);</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>          yData.insert(yData.begin(), 0.0);</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>        }</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>        <span class="comment">// add a separator</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>        xData.insert(xData.begin(), -1.0);</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>        yData.insert(yData.begin(), -1.0);</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>        i += gapSize+1; <span class="comment">// Update the index to the next data point</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>        <span class="keywordflow">if</span> (difference &gt; 1.75 * expectedDifference) {</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>          <span class="keywordtype">int</span> gapSize = (int) (difference / expectedDifference - 1);</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>          <span class="comment">/* Check if the gapsSize is larger than k, as this is the maximum gap size. If the gap size is less or equal to k, we add gapSize new data points to the data set between the two data points that show the gap, i.e. (i-1 and i). The new data points are filled with zero values for the intensity and inter/extrapolated values for the x-axis values.</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="comment">          */</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>          <span class="keywordflow">if</span> (gapSize &lt;= k) {</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = gapSize; j &gt;= 1; j--) { <span class="comment">// fill the gap backwards</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>              xData.insert(xData.begin() + i, xData[i-1] + j * expectedDifference);</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>              yData.insert(yData.begin() + i, 0.0);</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>            }</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>          } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>            <span class="comment">/* If the gapSize is larger than k, we limit the gap size to k and add k/2 new data points close to the (i-1) data point and k/2 new data points close to the (i) data point. The new data points are filled with zero values for the intensity and inter/extrapolated values for the x-axis values. Moreover, we add a separator for later splitting the data set into smaller data sets by adding an additional zero in between where the intensity and x-axis are set to -1.0. This is done to indicate that the data set should be split at this point.  </span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="comment">            */</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>            gapSize = k;</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>            <span class="comment">// add k/2 new data points close to the (i) data point</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt;= k/2; j++) { <span class="comment">// fill the gap forwards</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>              xData.insert(xData.begin() + i, xData[i] -  expectedDifference);</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>              yData.insert(yData.begin() + i, 0.0);</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>            }</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>            <span class="comment">// add a separator</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>            xData.insert(xData.begin() + i, -1.0);</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>            yData.insert(yData.begin() + i, -1.0);</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>            <span class="comment">// add k/2 new data points close to the (i-1) data point </span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = k/2; j &gt;= 1; j--) { <span class="comment">// fill the gap backwards</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>              xData.insert(xData.begin() + i, xData[i-1] + j * expectedDifference);</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>              yData.insert(yData.begin() + i, 0.0);</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>            }     </div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>          }</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>          i += gapSize; <span class="comment">// Update the index to the next data point</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>        }  <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>          <span class="comment">// update the expected difference</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>          expectedDifference = (expectedDifference + difference) / 2;</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>        } </div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>      }   </div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    }</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>    <span class="comment">/* We will always add new data points in the end of the data set. */</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>    <span class="keywordtype">int</span> gapSize = (int) k/2;</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt;= gapSize; j++) { <span class="comment">// fill the gap forwards</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>      xData.push_back(xData[xData.size()-1] + expectedDifference);</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>      yData.push_back(0.0);</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    }</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>  }</div>
</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span> </div>
<div class="foldopen" id="foldopen00082" data-start="{" data-end="}">
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno"><a class="line" href="classq_1_1_measurement_data.html#a132a6fa74bc575aaeccd260d73b96f00">   82</a></span>  std::vector&lt;size_t&gt; <a class="code hl_function" href="classq_1_1_measurement_data.html#a132a6fa74bc575aaeccd260d73b96f00">MeasurementData::cutData</a>(</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>    std::vector&lt;double&gt;&amp; xData, </div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    std::vector&lt;double&gt;&amp; yData)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    <span class="comment">// find the separator</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    std::vector&lt;size_t&gt; separators;</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; xData.size(); i++) {</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>      <span class="keywordflow">if</span> (xData[i] == -1.0 &amp;&amp; yData[i] == -1.0) {</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>        separators.push_back(i);</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>      }</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    }</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    <span class="keywordflow">return</span> separators;</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>  }</div>
</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span> </div>
<div class="foldopen" id="foldopen00095" data-start="{" data-end="}">
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno"><a class="line" href="classq_1_1_measurement_data.html#afc29734a2b7987f7a7510493c68b3a2c">   95</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classq_1_1_measurement_data.html#afc29734a2b7987f7a7510493c68b3a2c">MeasurementData::interpolateData</a>(</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    std::vector&lt;double&gt;&amp; xData, </div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    std::vector&lt;double&gt;&amp; yData) {</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span> </div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>  }</div>
</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    </div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>} <span class="comment">// namespace q</span></div>
<div class="ttc" id="aclassq_1_1_measurement_data_html_a132a6fa74bc575aaeccd260d73b96f00"><div class="ttname"><a href="classq_1_1_measurement_data.html#a132a6fa74bc575aaeccd260d73b96f00">q::MeasurementData::cutData</a></div><div class="ttdeci">std::vector&lt; size_t &gt; cutData(std::vector&lt; double &gt; &amp;xData, std::vector&lt; double &gt; &amp;yData) const</div><div class="ttdoc">Cut the data into smaller data sets.</div><div class="ttdef"><b>Definition</b> <a href="#l00082">qalgorithms_measurement_data.cpp:82</a></div></div>
<div class="ttc" id="aclassq_1_1_measurement_data_html_ae3dfbca5264b979f312f581491addf63"><div class="ttname"><a href="classq_1_1_measurement_data.html#ae3dfbca5264b979f312f581491addf63">q::MeasurementData::zeroFilling</a></div><div class="ttdeci">void zeroFilling(std::vector&lt; double &gt; &amp;xData, std::vector&lt; double &gt; &amp;yData, int k)</div><div class="ttdoc">Identify and fill gaps in the data.</div><div class="ttdef"><b>Definition</b> <a href="#l00007">qalgorithms_measurement_data.cpp:7</a></div></div>
<div class="ttc" id="aclassq_1_1_measurement_data_html_afc29734a2b7987f7a7510493c68b3a2c"><div class="ttname"><a href="classq_1_1_measurement_data.html#afc29734a2b7987f7a7510493c68b3a2c">q::MeasurementData::interpolateData</a></div><div class="ttdeci">void interpolateData(std::vector&lt; double &gt; &amp;xData, std::vector&lt; double &gt; &amp;yData)</div><div class="ttdoc">Interpolate y-axis values.</div><div class="ttdef"><b>Definition</b> <a href="#l00095">qalgorithms_measurement_data.cpp:95</a></div></div>
<div class="ttc" id="anamespaceq_html"><div class="ttname"><a href="namespaceq.html">q</a></div><div class="ttdef"><b>Definition</b> <a href="qalgorithms_8h_source.html#l00020">qalgorithms.h:20</a></div></div>
<div class="ttc" id="aqalgorithms__measurement__data_8h_html"><div class="ttname"><a href="qalgorithms__measurement__data_8h.html">qalgorithms_measurement_data.h</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
